<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS解析工具测试</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        button { padding: 10px 20px; margin: 10px; }
        input, select { padding: 8px; margin: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>DNS解析工具测试页面</h1>
    
    <div class="test-section">
        <h2>元素测试</h2>
        <input type="text" id="domain" placeholder="输入域名" value="google.com">
        <select id="record-type">
            <option value="A">A记录</option>
            <option value="AAAA">AAAA记录</option>
        </select>
        <select id="dns-server">
            <option value="google">Google DNS</option>
            <option value="cloudflare">Cloudflare DNS</option>
        </select>
        <button id="resolve-btn">测试解析</button>
        <div id="results-content" class="result"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成');
            
            // 获取元素
            const domainInput = document.getElementById('domain');
            const recordTypeSelect = document.getElementById('record-type');
            const dnsServerInput = document.getElementById('dns-server');
            const resolveBtn = document.getElementById('resolve-btn');
            const resultsContent = document.getElementById('results-content');
            
            console.log('域名输入框:', domainInput);
            console.log('记录类型选择:', recordTypeSelect);
            console.log('DNS服务器选择:', dnsServerInput);
            console.log('解析按钮:', resolveBtn);
            
            if (resolveBtn) {
                resolveBtn.addEventListener('click', async function() {
                    console.log('按钮被点击了！');
                    
                    const domain = domainInput.value.trim();
                    const recordType = recordTypeSelect.value;
                    const dnsServer = dnsServerInput.value;
                    
                    console.log('域名:', domain);
                    console.log('记录类型:', recordType);
                    console.log('DNS服务器:', dnsServer);
                    
                    resultsContent.innerHTML = '正在解析...';
                    
                    try {
                        const response = await fetch('/api/resolve', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                domain: domain,
                                recordType: recordType,
                                dnsServer: dnsServer
                            })
                        });
                        
                        console.log('响应状态:', response.status);
                        
                        const data = await response.json();
                        console.log('响应数据:', data);
                        
                        if (response.ok) {
                            resultsContent.innerHTML = `
                                <h3>解析成功！</h3>
                                <p><strong>域名:</strong> ${data.domain}</p>
                                <p><strong>记录类型:</strong> ${data.recordType}</p>
                                <p><strong>结果:</strong> ${data.result}</p>
                            `;
                        } else {
                            resultsContent.innerHTML = `<p style="color: red;">解析失败: ${data.error}</p>`;
                        }
                    } catch (error) {
                        console.error('请求错误:', error);
                        resultsContent.innerHTML = `<p style="color: red;">网络错误: ${error.message}</p>`;
                    }
                });
                
                console.log('按钮事件已绑定');
            } else {
                console.error('找不到解析按钮');
            }
        });
    </script>
</body>
</html>